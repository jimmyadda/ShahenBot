<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>מבזקים</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div class="container py-3">

  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 class="m-0">מבזק הודעות לדיירים</h3>
    <a class="btn btn-outline-secondary" href="{{ url_for('admin_dashboard') }}">חזרה לדשבורד</a>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="alert alert-{{category}}">{{msg}}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="card mb-4">
    <div class="card-header">יצירת הודעה</div>
    <div class="card-body">
      <form method="post" action="/admin/announcements/create" class="row g-2">

        {% if role == "super_admin" %}
        <div class="col-md-4">
          <label class="form-label">בניין</label>
          <select name="building_id" class="form-select" required>
            <option value="">בחר בניין...</option>
            {% for b in buildings %}
              <option value="{{b.id}}" {% if building_id==b.id %}selected{% endif %}>
                {{b.city}} {{b.street}} {{b.number}}{% if b.name %} ({{b.name}}){% endif %}
              </option>
            {% endfor %}
          </select>
        </div>
        {% else %}
          <input type="hidden" name="building_id" value="{{building_id}}">
        {% endif %}

        <div class="col-md-4">
          <label class="form-label">לקבוצת יעד</label>
          <select name="target_group" class="form-select">
            <option value="all">כל הדיירים</option>
            <option value="owners">בעלי דירות</option>
            <option value="renters">שוכרים</option>
          </select>
        </div>

        <div class="col-md-12">
          <label class="form-label">כותרת</label>
          <input class="form-control" name="title" maxlength="120" required>
        </div>

        <div class="col-md-12">
          <label class="form-label">תוכן</label>
          <textarea class="form-control" name="body" rows="4" required></textarea>
        </div>

        <div class="col-12">
          <button class="btn btn-primary">שלח לדיירים</button>
        </div>

      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header">הודעות אחרונות</div>
    <div class="card-body">
      {% if not items %}
        <div class="alert alert-info m-0">אין הודעות עדיין.</div>
      {% else %}
        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead>
              <tr>
                <th>#</th>
                <th>בניין</th>
                <th>כותרת</th>
                <th>קהל יעד</th>
                <th>נוצר</th>
              </tr>
            </thead>
            <tbody>
              {% for a in items %}
                <tr>
                  <td>{{a.id}}</td>
                  <td>{{a.building_id}}</td>
                  <td>{{a.title}}</td>
                  <td>{{a.target_group}}</td>
                  <td>{{a.created_at}}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}
    </div>
  </div>

</div>
</body>
</html>
